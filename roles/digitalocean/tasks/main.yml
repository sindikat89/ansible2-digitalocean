---
- name: ensure ssh key exists
  user: >
    name={{ ansible_user_id }}
    generate_ssh_key=yes
    ssh_key_file=.ssh/id_rsa
- name: ensure key exists at DigitalOcean
  digital_ocean: >
    state=present
    command=ssh
    name=root
    ssh_pub_key={{ lookup('file', '~/.ssh/id_rsa.pub') }}
    api_token={{ do_token }}
  register: root

- name: ensure droplet one exists
  digital_ocean: >
    state=present
    command=droplet
    name=droplet-one
    unique_name=yes
    size_id=512mb
    region_id=nyc1
    image_id=ubuntu-16-04-x64
    ssh_key_ids={{ root.ssh_key.id }}
    api_token={{ do_token }}
  register: droplet_one

- debug: msg="IP is {{ droplet_one.droplet.ip_address }}"